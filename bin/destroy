#!/bin/bash

set -e
directory=`dirname $0`
source setenv

if terraform destroy -force -var-file=${variablefiles} ;  then

    text="Terraform destroy executed on poc poc"
    escapedText=$(echo $text | sed 's/"/\"/g' | sed "s/'/\'/g" )

    json="{\"channel\": \"#$channel\", \"text\": \"$escapedText\"}"

    curl -X POST --data-urlencode "$json" "https://hooks.slack.com/services/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"
    
    $directory/slack terraform destroy to ${product}-${environment} has succeed
else 
    $directory/slack terraform destroy to ${product}-${environment} has failed
fi    